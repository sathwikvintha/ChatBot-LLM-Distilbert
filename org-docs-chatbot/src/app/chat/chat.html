<div class="chat-wrapper" role="region" aria-labelledby="org-docs-assistant-title">
    <!-- Header Section -->
    <header class="chat-header">
        <div class="header-left">
            <h1 id="org-docs-assistant-title" class="title">ğŸ“˜ Org Docs Assistant</h1>
            <p class="subtitle">Ask about your documents â€” answers include citations and source links.</p>
        </div>
        <div class="header-right">
            <span class="version">v1.0</span>
        </div>
    </header>

    <!-- Search Input Form -->
    <form class="chat-box" (ngSubmit)="askQuestion()" novalidate>
        <label for="question" class="visually-hidden">Ask about your documents</label>
        <input id="question" [(ngModel)]="question" name="question" type="text"
            placeholder="Ask about your documents..." class="chat-input" aria-label="Ask about your documents"
            autocomplete="off" required />

        <button type="submit" class="chat-button" [disabled]="loading || !question || !question.trim()"
            aria-live="polite">
            <ng-container *ngIf="!loading">
                ğŸ” Search
            </ng-container>
            <ng-container *ngIf="loading">
                <svg class="btn-spinner" viewBox="0 0 50 50" aria-hidden="true">
                    <circle cx="25" cy="25" r="20" fill="none" stroke="white" stroke-width="5" />
                </svg>
                Searchingâ€¦
            </ng-container>
        </button>
    </form>

    <!-- Error Message -->
    <div *ngIf="errorMessage" class="chat-error" role="alert" aria-live="assertive">
        âš ï¸ {{ errorMessage }}
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="chat-loading" role="status" aria-live="polite">
        <svg class="spinner" viewBox="0 0 50 50" aria-hidden="true">
            <circle cx="25" cy="25" r="20" fill="none" stroke-width="5" />
        </svg>
        <span>ğŸ” Searching your documentsâ€¦</span>
    </div>

    <!-- Answer Section -->
    <section *ngIf="answer" class="chat-answer" aria-live="polite">
        <h2 class="section-title">âœ¨ Answer</h2>
        <article class="answer-bubble" role="article">
            <p class="answer-text">{{ answer }}</p>
        </article>
    </section>

    <!-- Citations Section -->
    <section *ngIf="citations && citations.length" class="chat-citations" aria-labelledby="citations-title">
        <h2 id="citations-title" class="section-title">
            ğŸ“š Citations
            <span class="badge" aria-label="{{ citations.length }} citations">{{ citations.length }}</span>
        </h2>

        <div class="citations-list">
            <article *ngFor="let c of citations; let i = index" class="citation-card" role="article">
                <header class="citation-header">
                    <span class="file-icon" aria-hidden="true">ğŸ“„</span>
                    <div class="citation-info">
                        <strong class="citation-path">{{ c.source_path }}</strong>
                        <small class="citation-sub">
                            {{ c.section_heading || (c.page_number ? 'Page ' + c.page_number : 'Document excerpt') }}
                        </small>
                    </div>
                </header>

                <div class="citation-snippet" aria-label="Citation snippet">
                    {{ c.snippet }}
                </div>

                <footer class="citation-footer">
                    <button class="link-button" type="button" (click)="openSource(c)"
                        aria-label="Open {{ c.source_path }} in new tab">
                        ğŸ”— Open source
                    </button>
                </footer>
            </article>
        </div>
    </section>

    <!-- Footer -->
    <footer class="chat-footer">
        <small>ğŸ’¡ Tip: Ask specific questions for best results.</small>
    </footer>
</div>